!function(){var t=angular.module("ICount",["ngRoute","appServices","ui.bootstrap","report"]);t.directive("a",function(){return{restrict:"E",link:function(t,e,r){(""==r.href||"#"==r.href)&&e.on("click",function(t){t.preventDefault()})}}}),t.filter("custNo",function(){return function(t){var e=t;return 10>e&&(0>e?(e=0,e="0"+e):e="0"+e),e}}),t.filter("time_am_pm",function(){return function(t){var e=moment(t,"hh:mm").format("hh:mm a");return e}}),t.filter("hdate",function(){return function(t){text={4:"-",6:"-"},String.prototype.insertTextAtIndices=function(t){return this.replace(/./g,function(e,r){return t[r]?t[r]+e:e})},t=t.insertTextAtIndices(text);var e=moment(t).format("ddd. DD MMM");return e}}),t.filter("htime",function(){return function(t){return t=t.substring(0,2)+":"+t.substring(2),t+"pm"}}),t.filter("hrtomin",function(){return function(t){var e=Math.floor(t/60),r=t%60;return e+"hrs "+r+"mins"}}),t.filter("shortdate",function(){return function(t){var e=moment(t).format("ddd. DD MMM");return e}}),t.filter("lastlegDate",function(){return function(t){$total_channel=-1;for(property in t)t.hasOwnProperty(property)&&$total_channel++;return $arr_leg="leg"+$total_channel,$arr_date=t[$arr_leg]["@desDate"],$arr_date=moment($arr_date).format("ddd. DD MMM")}}),t.filter("lastlegTime",function(){return function(t){$total_channel=-1;for(property in t)t.hasOwnProperty(property)&&$total_channel++;return $arr_leg="leg"+$total_channel,$arr_date=t[$arr_leg]["@desDate"],$arr_time=t[$arr_leg]["@desTime"],$arr_time=moment($arr_date+" "+$arr_time).format("hh:mm a")}}),t.filter("stopover",function(){return function(t){$total_channel=-1;for(property in t)t.hasOwnProperty(property)&&$total_channel++;return $total_channel}}),t.filter("lower_price",function(){return function(t){try{return t[0].HotelRoom.Price.Amount}catch(e){return t.HotelRoom.Price.Amount}}}),t.filter("first_b",function(){return function(t){try{return t[0].HotelRoom.Board.$}catch(e){return t.HotelRoom.Board.$}}}),t.filter("first_r",function(){return function(t){try{return t[0].HotelRoom.RoomType.$}catch(e){return t.HotelRoom.RoomType.$}}}),t.filter("first_c",function(){return function(t){try{return t[0].Name}catch(e){return t.Name}}}),t.filter("peradult",function(){return function(t){return Array.isArray(t)?Array.isArray(t[0].PriceList.Price)?t[0].PriceList.Price[0].Amount:t[0].PriceList.Price.Amount:Array.isArray(t.PriceList.Price)?t.PriceList.Price[0].Amount:t.PriceList.Price.Amount}}),t.filter("first_d",function(t){return function(e){return Array.isArray(e)?Array.isArray(e[0].OperationDateList.OperationDate)?t(e[0].OperationDateList.OperationDate[0]["@date"]):t(e[0].OperationDateList.OperationDate["@date"]):Array.isArray(e.OperationDateList.OperationDate)?t(e.OperationDateList.OperationDate[0]["@date"]):t(e.OperationDateList.OperationDate["@date"])}}),t.filter("hotel_room",function(){return function(t){return room_opt=t.length,room_opt>1?room_opt:1}}),t.filter("imglarge",function(){return function(t){try{newimg=t.replace("/small","")}catch(e){newimg=t}return newimg}}),t.filter("hotel_r",function(){return function(t){return room_opt=t.length,room_opt>1?"Room Options":"Room Option"}}),t.filter("pernight",function(){return function(t,e){return t instanceof Array?(console.log("an array"),"undefined"==typeof t[0].HotelRoom.Price.PriceList?parseFloat(parseFloat(t[0].HotelRoom.Price.Amount)/e).toFixed(2):t[0].HotelRoom.Price.PriceList.Price instanceof Array?t[0].HotelRoom.Price.PriceList.Price[0].Amount:t[0].HotelRoom.Price.PriceList.Price.Amount?t[0].HotelRoom.Price.PriceList.Price.Amount:void 0):(console.log("not array"),"undefined"!=typeof t.HotelRoom.Price.PriceList?t.HotelRoom.Price.PriceList.Price instanceof Array?t.HotelRoom.Price.PriceList.Price[0].Amount:t.HotelRoom.Price.PriceList.Price.Amount:t.HotelRoom.Price.Amount)}}),t.filter("hotel_room_policy",function(t,e){return function(r){if(Array.isArray(r.CancellationPolicy)){for(policy="",$i=0;$i<r.CancellationPolicy.length;$i++)policy='<div class="col-md-18">Cancellation after '+t(r.CancellationPolicy[$i]["@time"])+" "+e(r.CancellationPolicy[$i]["@dateFrom"])+" will Cost "+r.CancellationPolicy[$i]["@amount"]+"</div>"+policy;return policy}return"<div> Cancellation after "+t(r.CancellationPolicy["@time"])+" "+e(r.CancellationPolicy["@dateFrom"])+" will Cost "+r.CancellationPolicy["@amount"]+"</div>"}}),t.filter("tour_cancel_policy",function(t,e){return function(t){if(Array.isArray(t)){for(policy="",$i=0;$i<t.length;$i++)policy='<div class="col-md-18">Cancellation from '+e(t[$i].Price.DateTimeFrom["@date"])+" to "+e(t[$i].Price.DateTimeTo["@date"])+" will Cost "+t[$i].Price.Amount+"</div>"+policy;return policy}return'<div class="col-md-18">Cancellation from '+e(t.Price.DateTimeFrom["@date"])+" to "+e(t.Price.DateTimeTo["@date"])+" will Cost "+t.Price.Amount+"</div>"}}),t.service("searchData",function(){var t=[{fAdult:1}];return{data:function(){return t},setData:function(e,r){t.push({valueName:e,valueData:r})}}}),t.service("userData",function(){var t=[{status:"Register"}];return{data:function(){return t},setData:function(e){t.splice(1,1,e)},addData:function(e,r){t[r].push(e)}}}),t.config(["$routeProvider",function(t){t.when("/home",{templateUrl:"partials/home.php"}).when("/report",{templateUrl:"partials/report.php",controller:"report"}).otherwise({redirectTo:"/home"})}]),t.controller("ICount",["$scope","userData","$modal","$log","searchData","$location",function(t,e,r){function n(){var r=o("icountUser");""!=r?(e.setData(JSON.parse(r)),t.getUdata=e.data(),t.getUdata[0].status="Logged_in"):t.getUdata=e.data()}function o(t){for(var e=t+"=",r=document.cookie.split(";"),n=0;n<r.length;n++){var o=r[n].trim();if(0==o.indexOf(e))return o.substring(e.length,o.length)}return""}n(),t.openRegister=function(){r.open({templateUrl:"template/register_user.html",controller:"registerModalInstanceCtrl",windowClass:"register-modal-window",resolve:{account:function(){return t.account}}})}}]),t.controller("registerModalInstanceCtrl",["$scope","userData","$modalInstance","account","registerUser","loginUserRs",function(t,e,r,n,o,a){function i(t,e,r){var n=new Date;n.setTime(n.getTime()+24*r*60*60*1e3);var o="expires="+n.toUTCString();document.cookie=t+"="+JSON.stringify(e)+"; "+o}t.reset=function(){t.user=angular.copy(t.master),t.login=angular.copy(t.master)},t.account={action:"log_reg"},t.reset(),t.login=function(n){t.loginD=a.query({pass:n.password,email:n.email},function(n){console.log(n),"error"!=n[0].info?(e.setData(n[0]),t.getUdata=e.data(),t.getUdata[0].status="Logged_in",r.dismiss("cancel")):t.login_error=n[0].error_message})},t.ok=function(n){t.regUser=o.get({title:n.title,fname:n.fname,lname:n.lname,email:n.email,pass:n.password,phone:n.phone,date_birth:n.dbirth,con_add:n.caddress,city:n.city,state:n.state,postal_c:n.pcode,country:n.country,national:n.nationality,agent:n.agent},function(){"o"==t.regUser[0]&&(e.setData(n),i("icountUser",n,30),t.getUdata=e.data(),t.getUdata[0].status="Logged_in",console.log(e.data()),r.dismiss("cancel"))})},t.cancel=function(){r.dismiss("cancel")}}]),t.directive("dateFrom",function(){return function(t,e){e.datepicker({defaultDate:"+1w",dateFormat:"dd MM yy",minDate:0,changeMonth:!0,numberOfMonths:3,onClose:function(e){var r=$(this).datepicker("getDate");r&&r.setDate(r.getDate()+1),$("#todate").datepicker("option","minDate",r||1);var n=e.split(" ");t.f_day=n[0],t.f_month=n[1],t.f_year=n[2],"Flights"!=t.curr_search.service?(t.getData[1].hcheckin=moment(e).format("YYYYMMDD"),t.getData[1].hcheckinL=moment(e).format("ddd Do, MMM, YYYY")):(t.getData[0].fDepDate=moment(e).format("YYYYMMDD"),t.getData[0].fDepDateLong=moment(e).format("ddd Do, MMM, YYYY")),t.d_checkin=moment(e).format("YYYY-MM-DD"),$num=t.get_days(),t.getData[0].fTravelDays=$num,t.t_num_days=$num,t.$apply(),$("#todate").focus()}})}}),t.directive("dateTo",function(){return function(t,e){e.datepicker({dateFormat:"dd MM yy",changeMonth:!0,changeYear:!0,numberOfMonths:3,onClose:function(e){$("#fromdate").datepicker("option","maxDate",e);var r=e.split(" ");t.t_day=r[0],t.t_month=r[1],t.t_year=r[2],"Flights"!=t.curr_search.service?(t.getData[1].hcheckout=moment(e).format("YYYYMMDD"),t.getData[1].hcheckoutL=moment(e).format("ddd Do, MMM, YYYY")):(t.getData[0].fDesDate=moment(e).format("YYYYMMDD"),t.getData[0].fDesDateLong=moment(e).format("ddd Do, MMM, YYYY")),t.d_checkout=moment(e).format("YYYY-MM-DD"),$num=t.get_days(),t.getData[0].fTravelDays=$num,t.t_num_days=$num,t.$apply()}})}}),t.directive("revealer",function(){return{link:function(t,e){e.bind("click",function(){e.siblings(".hideme").toggleClass("showme"),e.children(".minus_ic").toggleClass("showme"),e.children(".plus_ic").toggleClass("hideme")})}}})}(window.angular);